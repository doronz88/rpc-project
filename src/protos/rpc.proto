syntax = "proto3";

package rpc;

enum ProtocolConstants {
  UNKNOWN = 0;
  SERVER_VERSION = 0x8888811;
  MESSAGE_MAGIC = 0x1234569;
  REP_ERROR = 0x1000;
  RPC_PTY_BUFFER_SIZE = 0x10000;
  RPC_MAX_REQ_MSG_ID = 0x100;
}

enum Arch {
  ARCH_UNKNOWN = 0;
  ARCH_ARM64 = 1;
}

message RpcMessage {
  uint32 magic = 1;
  uint32 client_id = 2;
  uint32 msg_id = 3;
  bytes payload = 4;
}

message RpcPtyMessage {
  oneof type {
    bytes buffer = 1;
    uint32 exit_code = 2;
  }
}

message Handshake {
  uint32 magic = 1;
  Arch arch = 2;
  string sysname = 3;
  string machine = 4;
  string platform = 5;
  uint32 server_version = 7;
  uint32 client_id = 8;
}